<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin ‚Äî StreetWOD ¬∑ WOD Semanal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="admin.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    .flatpickr-calendar {
      background: #111114;
      border: 1px solid #1e1e24;
      box-shadow: 0 12px 40px rgba(0,0,0,.6);
      font-family: 'Inter', sans-serif;
    }
    .flatpickr-months .flatpickr-month,
    .flatpickr-current-month .flatpickr-monthDropdown-months,
    .flatpickr-weekdays,
    span.flatpickr-weekday {
      background: #111114;
      color: #a1a1aa;
    }
    .flatpickr-current-month input.cur-year,
    .flatpickr-current-month .flatpickr-monthDropdown-months {
      color: #fafafa;
    }
    .flatpickr-day {
      color: #fafafa;
      border-radius: 6px;
    }
    .flatpickr-day:hover {
      background: rgba(245,158,11,0.15);
      border-color: transparent;
    }
    .flatpickr-day.today {
      border-color: #f59e0b;
    }
    .flatpickr-day.selected {
      background: #f59e0b;
      border-color: #f59e0b;
      color: #0a0a0b;
    }
    .flatpickr-day.selected:hover {
      background: #d97706;
      border-color: #d97706;
    }
    .flatpickr-months .flatpickr-prev-month,
    .flatpickr-months .flatpickr-next-month {
      fill: #a1a1aa;
    }
    .flatpickr-months .flatpickr-prev-month:hover svg,
    .flatpickr-months .flatpickr-next-month:hover svg {
      fill: #f59e0b;
    }
    .flatpickr-day.flatpickr-disabled,
    .flatpickr-day.prevMonthDay,
    .flatpickr-day.nextMonthDay {
      color: #3f3f46;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- LOGIN -->
    <div id="login-screen" class="screen">
      <div class="login-card">
        <img src="logo.png" alt="StreetWOD" class="login-logo">
        <h1>Admin</h1>
        <p class="login-desc">Gestiona los WODs semanales de StreetWOD</p>
        <form id="login-form" class="login-form">
          <input type="email" id="login-email" placeholder="Email" required autocomplete="email">
          <input type="password" id="login-password" placeholder="Contrase√±a" required autocomplete="current-password">
          <button type="submit" class="btn btn-primary" id="login-btn">Iniciar sesi√≥n</button>
          <p id="login-error" class="error-msg"></p>
        </form>
      </div>
    </div>

    <!-- PANEL -->
    <div id="panel-screen" class="screen hidden">
      <nav class="admin-nav">
        <a href="index.html" class="back-link">‚Üê Volver</a>
        <span class="admin-user" id="admin-email"></span>
        <button type="button" class="btn btn-ghost btn-sm" id="logout-btn">Cerrar sesi√≥n</button>
      </nav>
      <main class="admin-main">
        <div id="no-auth-msg" class="no-auth hidden">
          <p>No tienes permisos de administrador. Contacta con el equipo si crees que deber√≠as tener acceso.</p>
        </div>
        <div id="admin-content" class="hidden">
          <h2>A√±adir WOD semanal</h2>
          <form id="wod-form" class="wod-form" autocomplete="off">

            <!-- Row: Semana + Formato -->
            <div class="form-row">
              <div class="form-group">
                <label for="week_start">Fecha del WOD</label>
                <input type="date" id="week_start" required>
              </div>
              <div class="form-group">
                <label for="format">Formato</label>
                <select id="format" required>
                  <option value="For Time">For Time</option>
                  <option value="AMRAP">AMRAP</option>
                  <option value="EMOM">EMOM</option>
                  <option value="Tabata">Tabata</option>
                  <option value="Chipper">Chipper</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>

            <!-- Row: T√≠tulo + Dificultad -->
            <div class="form-row">
              <div class="form-group">
                <label for="title">T√≠tulo</label>
                <input type="text" id="title" placeholder="Ej: Fran, Murph, Cindy..." required maxlength="100">
              </div>
              <div class="form-group">
                <label for="difficulty">Dificultad</label>
                <select id="difficulty">
                  <option value="1">1 - Easy</option>
                  <option value="2">2 - Moderate</option>
                  <option value="3" selected>3 - Hard</option>
                  <option value="4">4 - Very Hard</option>
                  <option value="5">5 - Brutal</option>
                </select>
              </div>
            </div>

            <!-- Descripci√≥n -->
            <div class="form-group">
              <label for="description">Descripci√≥n (opcional)</label>
              <textarea id="description" rows="2" placeholder="Instrucciones adicionales..."></textarea>
            </div>

            <!-- Format-specific fields -->
            <div id="format-fields" class="format-fields">
              <!-- For Time / Chipper / Other -->
              <div class="form-row" id="row-rounds" style="display:none">
                <div class="form-group">
                  <label for="rounds">Rondas</label>
                  <input type="number" id="rounds" min="1" value="1" placeholder="1">
                </div>
                <div class="form-group">
                  <label for="time_cap_minutes">Time Cap (min, opcional)</label>
                  <input type="number" id="time_cap_minutes" min="0" placeholder="-">
                </div>
              </div>

              <!-- Reps scheme -->
              <div class="form-group" id="row-reps-scheme" style="display:none">
                <label for="reps_scheme">Esquema de reps (opcional)</label>
                <input type="text" id="reps_scheme" placeholder="Ej: 21-15-9, 10-8-6-4-2...">
              </div>

              <!-- AMRAP -->
              <div class="form-group" id="row-amrap" style="display:none">
                <label for="amrap_minutes">Duraci√≥n AMRAP (min)</label>
                <input type="number" id="amrap_minutes" min="1" placeholder="12">
              </div>

              <!-- EMOM -->
              <div id="row-emom" style="display:none">
                <div class="form-row">
                  <div class="form-group">
                    <label for="emom_minutes">Duraci√≥n EMOM (min)</label>
                    <input type="number" id="emom_minutes" min="1" placeholder="20">
                  </div>
                  <div class="form-group">
                    <label for="emom_interval_seconds">Intervalo (seg)</label>
                    <input type="number" id="emom_interval_seconds" min="10" value="60" placeholder="60">
                  </div>
                </div>
                <div class="form-group" style="margin-top:0.75rem">
                  <label for="emom_intervals_count">Intervalos diferentes</label>
                  <input type="number" id="emom_intervals_count" min="1" max="10" value="1">
                  <small>Ej: 3 intervalos = Min1, Min2, Min3 que se repiten c√≠clicamente</small>
                </div>
              </div>

              <!-- Tabata: solo time cap -->
              <div class="form-group" id="row-tabata-cap" style="display:none">
                <label for="tabata_time_cap">Time Cap (min, opcional)</label>
                <input type="number" id="tabata_time_cap" min="0" placeholder="-">
              </div>
            </div>

            <!-- ========== CASH IN ========== -->
            <div class="exercise-section" id="section-cash-in">
              <div class="exercise-section-header">
                <span class="exercise-section-icon">üî•</span>
                <h3>Cash In <small>(opcional)</small></h3>
                <button type="button" class="btn btn-sm btn-add" id="btn-add-cash-in">+ Ejercicio</button>
              </div>
              <div id="list-cash-in" class="exercise-list"></div>
            </div>

            <!-- ========== EJERCICIOS PRINCIPALES ========== -->
            <div class="exercise-section" id="section-exercises">
              <div class="exercise-section-header">
                <span class="exercise-section-icon">üí™</span>
                <h3>Ejercicios</h3>
                <button type="button" class="btn btn-sm btn-add" id="btn-add-exercise" style="display:none">+ Ejercicio</button>
              </div>
              <!-- Non-EMOM: lista normal -->
              <div id="list-exercises" class="exercise-list"></div>
              <!-- EMOM: intervalos -->
              <div id="emom-intervals-container" class="emom-intervals" style="display:none"></div>
            </div>

            <!-- ========== CASH OUT ========== -->
            <div class="exercise-section" id="section-cash-out">
              <div class="exercise-section-header">
                <span class="exercise-section-icon">üßä</span>
                <h3>Cash Out <small>(opcional)</small></h3>
                <button type="button" class="btn btn-sm btn-add" id="btn-add-cash-out">+ Ejercicio</button>
              </div>
              <div id="list-cash-out" class="exercise-list"></div>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary btn-lg" id="submit-wod-btn">Guardar WOD</button>
            <p id="form-error" class="error-msg"></p>
            <p id="form-success" class="success-msg"></p>
          </form>

          <hr class="section-divider">

          <h3>√öltimos WODs</h3>
          <div id="wod-list" class="wod-list"></div>
        </div>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
  <script src="admin.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      flatpickr('#week_start', {
        locale: 'es',
        dateFormat: 'Y-m-d',
        altInput: true,
        altFormat: 'd / m / Y',
        defaultDate: new Date(),
        disableMobile: true,
        theme: 'dark'
      });
    });
  </script>
</body>
</html>
